<!-- views/pages/market.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <% include partials/header%>
</head>
<body>
<div class="nav-container">
    <% include partials/nav%>
</div>
<div class="listing-container">
    <div class="listing-container-left">
        <div class="listing-container-left-top">
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="d-block w-100" src="//placehold.it/400x200" alt="First slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="//placehold.it/400x200" alt="Second slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="//placehold.it/400x200" alt="Third slide">
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
        </div>
        <div>
            <div class="listing-container-left-bottom">
                <div class="container pt-3">
                    <h1 class="display-4"><%=listingData.title%></h1>
                    <h2>$<%=listingData.price%>/day</h2>
                    <p class="lead"><%=listingData.description%></p>
                </div>
            </div>
        </div>
    </div>
    <div class="listing-container-right p-3">
        <h3>$<%=listingData.price%>/day</h3>
        <h4>Hire</h4>
        <label class="d-inline-block w-100" for="datepickerFrom">From:
            <input id="datepickerFrom" width="100%" />
        </label>
        <label class="d-inline-block w-100" for="datepickerTo">To:
            <input id="datepickerTo" width="100%" />
        </label>
        <p id="total"></p>
    </div>
</div>

<footer>
    <script>
        $('#datepickerFrom').datepicker({
            uiLibrary: 'bootstrap4'
        });
        $('#datepickerTo').datepicker({
            uiLibrary: 'bootstrap4'
        });
        var isDate_ = function(input) {
            var status = false;
            if (!input || input.length <= 0) {
                status = false;
            }
            else {
                var result = new Date(input);
                if (result == 'Invalid Date') {
                    status = false;
                } 
                else {
                    status = true;
                }
            }
            return status;
        }

        function parseDate(str) {
            var mdy = str.split('/');
            return new Date(mdy[2], mdy[0]-1, mdy[1]);
        }

        function dateDiff(first, second) {
            return Math.round((second-first)/(1000*60*60*24));
        }


        $('#datepickerTo').change(function(event) {
            var fromDate = $('#datepickerFrom').val();
            var toDate = $('#datepickerTo').val();

            if(isDate_(fromDate) && isDate_(toDate)) {
                fromDate = parseDate(fromDate);
                toDate = parseDate(toDate);
                var totalEl = $('#total');
                totalEl.html('Cost: $' + dateDiff(fromDate, toDate) * <%=listingData.price%> + '.00');
            }
        });
    </script>
</footer>

<link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
</body>
</html>
